<div class="container loading" ng-if="!sides">

    <div class="loading-msg">
        <h1>{{ 'loadingMsg' | translate }}</h1>
    </div>

</div>

<div class="container" ng-if="sides && sides.length > 1" ng-hide="sideIsSelected">

    <p>
        Выберите сторону стана для работы:
    </p>

    <select ng-model="selectedSide" ng-change="currentScales(selectedSide)">
        <option></option>
        <option ng-repeat="side in sides" value="{{side.ID}}">{{side.Description}}</option>
    </select>
</div>

<div class="container loading" ng-if="!scales && scaleLoading">

    <div class="loading-msg">
        <h1>{{ 'loadingMsg' | translate }}</h1>
    </div>

</div>

<div class="container" ng-if="scales && !scaleLoading">

    <div class="scaleWrapper">

        <div class="scaleGroup" ng-repeat="group in groups">

            <div class="scaleContainer"
                 ng-repeat="scale in group"
                 ng-class="{'active': scale.ID == currentScaleID}"
                 ng-click="showScaleInfo(scale.ID); getLatestWorkRequest(scale.ID)">
                <label>{{scale.Description}}</label>
                <h3>{{scale.weightCurrent}} кг</h3>
                <h4 ng-show="scale.ID != currentScaleID">
                    {{scale.rodsQuantity}} шт
                </h4>
                <h4 ng-show="scale.ID == currentScaleID">
                   {{rodsQuantity}} шт
                </h4>
            </div>
        </div>
    </div>

</div>

<div class="scaleDetailInfo" ng-show="currentScaleID">

    <div class="scaleInfo task">
        <label class="labelTask">Задание</label>

        <div style="text-align: right">

        </div>

        <div class="controlsWrapper">
            <div class="controlsGroup">
                <table>
                    <tr>
                        <td>Профиль</td>
                        <td>
                            <select ng-model="selectedProfile"
                                    ng-class="{'wrong': !selectedProfile}"
                                    ng-change="getProfilePropertiesList();">
                                <option></option>
                                <option ng-selected="selectedProfile==profile.ID" ng-repeat="profile in profiles"
                                        value="{{profile.ID}}">
                                    {{profile.Description}}
                                </option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td>Размер(м.)</td>
                        <td>
                            <input type="text"
                                   ng-model="length"
                                   ng-change="calculate()" />
                        </td>
                    </tr>

                    <tr>
                        <td>Количество прутков(шт.)</td>
                        <td>
                            <input type="text"
                                   ng-model="barQuantity"
                                   ng-change="calculate()" />
                        </td>
                    </tr>
                </table>
            </div>

            <div class="controlsGroup" style="padding:10px;">

                <div>
                    <input type="checkbox" 
                           ng-model="sandwichMode" 
                           ng-change="enableControlOK();" />
                    Бутерброд
                </div>
                <div>
                    <input type="checkbox" 
                           ng-model="approvingMode" 
                           ng-change="enableControlOK()" />
                    По подтверждению
                </div>

                <div style="margin-top: 45px">
                    <table>
                        <tr>
                            <td>Рекомендуемая масса минимум (кг)</td>
                            <td>
                                <input type="text"
                                       style="width: 37px;"
                                       readonly
                                       ng-model="minMassRec"
                                        />
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            
        </div>

        <div class="controlsWrapper">

            <div class="controlsGroup">
                <table>
                    <tr>
                        <td>Масса минимум(кг.)</td>
                        <td>

                            <input type="text"
                                   ng-model="minMass"
                                   ng-class="{'wrong': !minMass}"
                                   my-number-check
                                   ng-change="enableControlOK();" />
                        </td>
                    </tr>

                    <tr>
                        <td>Масса образца(кг.)</td>
                        <td>
                            <input type="text"
                                   ng-model="sampleMass"
                                   ng-change="calculate()" />
                        </td>
                    </tr>

                    <tr>
                        <td>Длина образца(м.)</td>
                        <td>
                            <input type="text"
                                   ng-model="sampleLength"
                                   ng-change="calculate()" />
                        </td>
                    </tr>
                </table>
            </div>
            <div class="controlsGroup">
                <table>
                    <tr>
                        <td>Масса максимум(кг.)</td>
                        <td>

                            <input type="text"
                                   ng-model="maxMass"
                                   ng-class="{'wrong': !maxMass}"
                                   my-number-check
                                   ng-change="enableControlOK();" />
                        </td>                       
                    </tr>

                    <tr>
                        <td>Вес прутка(кг.)</td>
                        <td><input type="text" readonly ng-model="barWeight" /></td>
                    </tr>

                    <tr>
                        <td>Отклонение(%)</td>
                        <td>
                            <input type="text" readonly
                                   ng-model="deviation"
                                   ng-class="{'wrong': deviationState == 'wrong'}" />
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="controls">
            <button class="btn"
                    ng-disabled="disableButtonOKTask"
                    ng-click="workRequest()">{{OKLabel}}</button>
        </div>
    </div>

    <div class="scaleInfo">
        <h4 class="scalesName">{{scalesDetailsInfo.ScalesName}}</h4>

        <span class="autoManuMsg" ng-show="!scalesDetailsInfo.AUTO_MANU">Автоматический режим</span>

        <p>
            <span ng-show="scalesDetailsInfo.POCKET_LOC">Весы заблокированы</span>
            <span ng-show="sandwichMode && !scalesDetailsInfo.PACK_SANDWICH">Первая пачка</span>
            <span ng-show="sandwichMode && scalesDetailsInfo.PACK_SANDWICH">Вторая пачка</span>
        </p>

        <p>
            Вес:
            <span class="scalesValue">
                {{scalesDetailsInfo.WEIGHT_CURRENT || 0}} кг
            </span>
        </p>

        <p>
            Количество прутков:
            <span class="rodsValue">
                {{rodsQuantity || 0}} шт
            </span>
        </p>

        <p>
            Осталось прутков:
            <span class="rodsValue">
                {{rodsLeft || barQuantity}} шт
            </span>
        </p>

        <div class="isStableScalesIndicator" ng-show="scalesDetailsInfo.WEIGHT_STAB">
        </div>

        <span class="weightZeroIndicator" ng-show="scalesDetailsInfo.WEIGHT_ZERO">>0<</span>

        <div class="controls">
            
            <button class="btn" 
                    ng-disabled="!(
                    (!sandwichModeAccepted && scalesDetailsInfo.AUTO_MANU && scalesDetailsInfo.WEIGHT_STAB) 
                    || 
                    (sandwichModeAccepted && scalesDetailsInfo.PACK_SANDWICH && scalesDetailsInfo.AUTO_MANU && scalesDetailsInfo.WEIGHT_STAB))" 
                    ng-click="doAction('ins_JobOrderOPCCommandTakeWeightByCommOrder')">
                Взять вес
            </button>

            <button class="btn"
                    ng-show="sandwichModeAccepted"
                    ng-disabled="!(!scalesDetailsInfo.PACK_SANDWICH && scalesDetailsInfo.AUTO_MANU && scalesDetailsInfo.WEIGHT_STAB)"
                     ng-click="doAction('ins_JobOrderOPCCommandTakeTaraByCommOrder')">
                Взять тару
            </button>

            <button class="btn" ng-click="doAction('ins_MaterialLotByCommOrder')">
                Тестовая печать
            </button>
        </div>

    </div>

    <div class="scaleInfo">

        <div class="section">

            <div class="sectionItem">
                <label>Заказ:</label>
                <input type="text" class="input-small"
                       ng-change="checkIsAcceptedOrder()"
                       ng-model="commOrder"
                       my-enter="buildForm()" />  
            </div>

            <div class="sectionItem">
                <label>№ бригады:</label>
                <input type="text" class="input-small"
                       readonly
                       ng-model="brigadeNo" />  
            </div>

            <div class="sectionItem">
                <label>Дата</label>
                <input type="text" class="input-small"
                       readonly
                       ng-model="prodDate" />  
            </div>
                     
        </div>

        <button class="btn" ng-click="showBuildFormMarker()">Перемаркировка</button>
        
    </div>

</div>



<div class="black-wrapper" ng-show="isShowModal">
    <div class="modal">

        <div class="formWrapper">
            <form id="orderForm" novalidate></form>
        </div>

    </div>
</div>

<div class="black-wrapper" ng-show="toggleModalMarker">
    <div class="modal">
        <button ng-click="closeModal()" class="btn btn-circle pull-right"><i class="icon-remove"></i></button>

        <label>Введите номер бирки</label>
        <input type="text" ng-model="labelNumber" ng-readonly="readOnly" my-enter="buildFormRemarker()" />

        <div class="formWrapper">
            <form id="remarkerForm" novalidate></form>
        </div>
    </div>
</div>




